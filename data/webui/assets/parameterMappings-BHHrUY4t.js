import{r as g,l as R,j as e,h as k,m as V,p as H,f as M,e as A,i as P,k as O,a as L,o as K}from"./index-BFi0q8B5.js";function q(t){const[a,s]=g.useState(""),[r,o]=g.useState(!0);return g.useEffect(()=>{const n=R(),c=`/${t}/mjpg/stream`,u=n?`${c}?token=${encodeURIComponent(n)}`:c;return s(u),o(!1),()=>{s("")}},[t]),{streamUrl:a,isLoading:r,error:null}}const $="camera-restarted";function Y({cameraId:t,className:a=""}){const{streamUrl:s,isLoading:r}=q(t),o=g.useRef(null),[n,c]=g.useState(0),u=g.useCallback(()=>{setTimeout(()=>{c(i=>i+1)},2e3)},[]);if(g.useEffect(()=>{const i=l=>{const x=l.detail?.cameraId;(!x||x===0||x===t)&&c(b=>b+1)};return window.addEventListener($,i),()=>{window.removeEventListener($,i)}},[t]),g.useEffect(()=>{c(0)},[t]),r)return e.jsx("div",{className:`w-full ${a}`,children:e.jsx("div",{className:"relative aspect-video bg-gray-900 animate-pulse rounded-lg",children:e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("svg",{className:"w-8 h-8 text-gray-600 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})})});const p=s?`${s}${s.includes("?")?"&":"?"}_k=${n}`:"";return e.jsx("div",{className:`w-full ${a}`,children:e.jsx("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:e.jsx("img",{ref:o,src:p,alt:`Camera ${t} stream`,className:"absolute inset-0 w-full h-full object-contain",onError:u})})})}function J({label:t,value:a,onChange:s,options:r,disabled:o=!1,required:n=!1,helpText:c,error:u}){const p=l=>{s(l.target.value)},i=!!u;return e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:[t,n&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("select",{value:a,onChange:p,disabled:o,required:n,className:`w-full px-3 py-2 bg-surface border rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${i?"border-red-500 focus:ring-red-500":"border-surface-elevated focus:ring-primary"}`,"aria-invalid":i,"aria-describedby":i?`${t}-error`:void 0,children:r.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),i&&e.jsx("p",{id:`${t}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:u}),c&&!i&&e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:c})]})}function Z({label:t,value:a,onChange:s,disabled:r=!1,helpText:o,error:n}){const c=()=>{r||s(!a)},u=!!n;return e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:c,disabled:r,className:"sr-only","aria-invalid":u}),e.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${a?"bg-primary":"bg-surface-elevated"} ${r?"opacity-50 cursor-not-allowed":""} ${u?"ring-2 ring-red-500":""}`}),e.jsx("div",{className:`absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${a?"transform translate-x-6":""}`})]}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"text-sm font-medium",children:t}),u&&e.jsx("p",{className:"text-sm text-red-400",role:"alert",children:n}),o&&!u&&e.jsx("p",{className:"text-sm text-gray-400",children:o})]})]})})}function ee({label:t,value:a,onChange:s,min:r,max:o,step:n=1,unit:c="",disabled:u=!1,required:p=!1,helpText:i,error:l,showValue:x=!0,scale:b="linear"}){const N=d=>{if(b==="linear")return d;if(d===0)return r;const h=r===0?1:r,v=Math.log(h),_=Math.log(o),S=Math.log(d);return h+(S-v)/(_-v)*(o-h)},m=d=>{if(b==="linear")return d;if(d===r)return 0;const h=r===0?1:r,v=Math.log(h),_=Math.log(o),S=(d-h)/(o-h),D=v+S*(_-v);return Math.round(Math.exp(D))},j=d=>{const h=Number(d.target.value),v=m(h);s(v)},f=!!l,y=N(a),T=(y-r)/(o-r)*100,U=b==="logarithmic"?m(r+(o-r)/2):(r+o)/2,C=d=>d===0&&r===0?"0":Number.isInteger(d)?d.toString():d.toFixed(n>=1?0:n.toString().split(".")[1]?.length||1);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-medium",children:[t,p&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),x&&e.jsxs("span",{className:"text-sm font-mono text-gray-400",children:[a,c]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"range",value:y,onChange:j,min:r,max:o,step:b==="logarithmic"?1:n,disabled:u,className:`w-full h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed
            ${f?"slider-error":"slider-default"}`,style:{background:`linear-gradient(to right,
              rgb(59, 130, 246) 0%,
              rgb(59, 130, 246) ${T}%,
              rgb(55, 65, 81) ${T}%,
              rgb(55, 65, 81) 100%)`},"aria-invalid":f,"aria-describedby":f?`${t}-error`:void 0}),e.jsx("div",{className:"relative w-full h-4 mt-1",children:[0,25,50,75,100].map(d=>{const h=d===0||d===50||d===100;return e.jsx("div",{className:"absolute",style:{left:`${d}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:`w-px bg-gray-500 mx-auto ${h?"h-3":"h-2"}`})},d)})}),e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[e.jsxs("span",{children:[C(r),c]}),e.jsxs("span",{children:[C(U),c]}),e.jsxs("span",{children:[C(o),c]})]})})]}),f&&e.jsx("p",{id:`${t}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:l}),i&&!f&&e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:i}),e.jsx("style",{children:`
        input[type='range']::-webkit-slider-thumb {
          appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-webkit-slider-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range']::-moz-range-thumb {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-moz-range-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range'].slider-error::-webkit-slider-thumb {
          background: rgb(239, 68, 68);
        }

        input[type='range'].slider-error::-moz-range-thumb {
          background: rgb(239, 68, 68);
        }
      `})]})}const E={list:async t=>(await M(`/0/api/profiles?camera_id=${t}`)).profiles||[],get:async t=>{const a=await M(`/0/api/profiles/${t}`);return{profile_id:a.profile_id,camera_id:a.camera_id,name:a.name,description:a.description,is_default:a.is_default,created_at:a.created_at,updated_at:a.updated_at,param_count:Object.keys(a.params).length,params:a.params}},create:async t=>(await k("/0/api/profiles",t)).profile_id,update:async(t,a)=>{await H(`/0/api/profiles/${t}`,a)},delete:async t=>{await V(`/0/api/profiles/${t}`)},apply:async t=>(await k(`/0/api/profiles/${t}/apply`,{})).requires_restart||[],setDefault:async t=>{await k(`/0/api/profiles/${t}/default`,{})}},w={all:["profiles"],lists:()=>[...w.all,"list"],list:t=>[...w.lists(),t],details:()=>[...w.all,"detail"],detail:t=>[...w.details(),t]};function B(t){return A({queryKey:w.list(t),queryFn:()=>E.list(t),staleTime:1e3*60*5})}function Q(){const t=P();return O({mutationFn:a=>E.create(a),onSuccess:(a,s)=>{t.invalidateQueries({queryKey:w.list(s.camera_id)})}})}function G(){const t=P();return O({mutationFn:a=>E.apply(a),onSuccess:()=>{t.invalidateQueries({queryKey:["config"]})}})}function z({cameraId:t,onClose:a}){const[s,r]=g.useState(""),[o,n]=g.useState(""),{mutate:c,isPending:u}=Q(),p=()=>{s.trim()&&c({name:s.trim(),description:o.trim()||void 0,camera_id:t,snapshot_current:!0},{onSuccess:()=>{a()},onError:l=>{console.error("Failed to save profile:",l)}})},i=l=>{l.key==="Enter"&&!l.shiftKey?(l.preventDefault(),p()):l.key==="Escape"&&a()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-surface-base border border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Save Configuration Preset"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors","aria-label":"Close dialog",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"profile-name",className:"block text-sm font-medium text-gray-400 mb-1",children:["Preset Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{id:"profile-name",type:"text",value:s,onChange:l=>r(l.target.value),onKeyDown:i,placeholder:"e.g., Daytime, Nighttime",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0,maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"profile-description",className:"block text-sm font-medium text-gray-400 mb-1",children:"Description (optional)"}),e.jsx("textarea",{id:"profile-description",value:o,onChange:l=>n(l.target.value),placeholder:"Brief description of this preset",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none",rows:2,maxLength:200})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"This will save your current camera settings including brightness, motion detection, and framerate."})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:a,disabled:u,className:"flex-1 px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:!s.trim()||u,className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors disabled:bg-primary/30 disabled:cursor-not-allowed",children:u?"Saving...":"Save"})]})]})})}function te({cameraId:t,readOnly:a=!1}){const s=P(),{data:r,isLoading:o,error:n}=B(t),{mutate:c,isPending:u}=G(),{addToast:p}=L(),[i,l]=g.useState(null),[x,b]=g.useState(!1),N=()=>{if(i){const j=r?.find(f=>f.profile_id===i)?.name||"profile";c(i,{onSuccess:async f=>{if(f.length>0){p(`Profile "${j}" applied. Restarting camera...`,"info");try{await K(t),await new Promise(y=>setTimeout(y,2e3)),await s.invalidateQueries({queryKey:["config"]}),p(`Profile "${j}" applied. Camera restarted.`,"success")}catch(y){console.error("Failed to restart camera:",y),p("Profile applied but camera restart failed. Please restart manually.","warning")}}else p(`Profile "${j}" applied successfully`,"success");l(null)},onError:f=>{p(`Failed to apply profile: ${f instanceof Error?f.message:"Unknown error"}`,"error")}})}};return n?e.jsx("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:e.jsxs("div",{className:"bg-danger/10 border border-danger rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-danger font-medium",children:"Failed to load profiles"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n instanceof Error?n.message:"Unable to connect to profiles API"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Configuration Preset"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("select",{disabled:o||!r||r.length===0,value:i??"",onChange:m=>l(Number(m.target.value)||null),className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white disabled:text-gray-500 disabled:cursor-not-allowed appearance-none focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:o?"Loading...":!r||r.length===0?"No presets available":"Select a preset"}),r?.map(m=>e.jsxs("option",{value:m.profile_id,children:[m.is_default?"⭐ ":"",m.name,m.description?` - ${m.description}`:""]},m.profile_id))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!a&&e.jsx("button",{type:"button",onClick:()=>b(!0),className:"px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors",title:"Save current settings as a new preset",children:"Save"}),e.jsx("button",{type:"button",onClick:N,disabled:!i||u,className:"px-4 py-2 bg-primary text-white rounded-lg disabled:bg-primary/30 disabled:text-gray-500 disabled:cursor-not-allowed hover:bg-primary-hover transition-colors",title:"Apply selected preset to camera",children:u?"Applying...":"Apply"})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Quick switch camera settings • ",r?.length||0," preset",r?.length!==1?"s":""]})]}),x&&e.jsx(z,{cameraId:t,onClose:()=>b(!1)})]})}function ae(t){const[a,s]=t.split("x").map(Number);return{width:a||0,height:s||0}}function re(t,a){return`${t}x${a}`}function se(t,a,s){return Math.round(t/100*a*s)}function le(t,a,s){const r=a*s;return r===0?0:Number((t/r*100).toFixed(2))}const F={disabled:"","camera-name":"%$",timestamp:"%Y-%m-%d\\n%T"};function oe(t){for(const[a,s]of Object.entries(F))if(s===t)return a;return"custom"}function ie(t,a){return t==="custom"&&a!==void 0?a:F[t]||""}const I={"motion-triggered":{picture_output:"on"},"motion-triggered-one":{picture_output:"first"},best:{picture_output:"best"},center:{picture_output:"center"},"interval-snapshots":{picture_output:"off",snapshot_interval:60},manual:{picture_output:"off",snapshot_interval:0},off:{picture_output:"off",snapshot_interval:0}};function ne(t,a){if(a>0)return"interval-snapshots";switch(t){case"on":return"motion-triggered";case"first":return"motion-triggered-one";case"best":return"best";case"center":return"center";case"off":return"manual";default:return"manual"}}function ce(t){return I[t]||{picture_output:"off",snapshot_interval:0}}const W={"motion-triggered":{movie_output:!0,movie_output_motion:!0,emulate_motion:!1},continuous:{movie_output:!0,movie_output_motion:!1,emulate_motion:!0},off:{movie_output:!1,emulate_motion:!1}};function ue(t,a,s=!1){return t?s?"continuous":"motion-triggered":"off"}function de(t){return W[t]||{movie_output:!1,emulate_motion:!1}}function pe(t){return A({queryKey:["cameraCapabilities",t],queryFn:async()=>{const a=await M("/0/status.json"),s=`cam${t}`,r=a.status[s];return r&&typeof r=="object"?r.supportedControls||{}:{}},staleTime:6e4,retry:1,enabled:t>0})}const me=[{width:320,height:240,label:"320x240 (QVGA)"},{width:640,height:480,label:"640x480 (VGA)"},{width:800,height:600,label:"800x600 (SVGA)"},{width:1024,height:768,label:"1024x768 (XGA)"},{width:1280,height:720,label:"1280x720 (HD)"},{width:1920,height:1080,label:"1920x1080 (Full HD)"},{width:2560,height:1440,label:"2560x1440 (QHD)"},{width:3840,height:2160,label:"3840x2160 (4K)"}],fe=[{value:0,label:"0°"},{value:90,label:"90°"},{value:180,label:"180°"},{value:270,label:"270°"}],ge=[{value:0,label:"Auto"},{value:1,label:"Incandescent"},{value:2,label:"Tungsten"},{value:3,label:"Fluorescent"},{value:4,label:"Indoor"},{value:5,label:"Daylight"},{value:6,label:"Cloudy"},{value:7,label:"Custom"}],he=[{value:0,label:"Manual"},{value:1,label:"Auto"},{value:2,label:"Continuous"}],be=[{value:0,label:"Normal"},{value:1,label:"Macro"},{value:2,label:"Full"}],xe=[{value:0,label:"Normal"},{value:1,label:"Fast"}],ve=[{value:"mkv",label:"MKV (Matroska)",group:"basic"},{value:"mp4",label:"MP4",group:"basic"},{value:"mov",label:"MOV (QuickTime)",group:"basic"},{value:"3gp",label:"3GP (Mobile)",group:"basic"},{value:"mkv:h264_v4l2m2m",label:"MKV - H.264 Hardware",group:"hardware"},{value:"mp4:h264_v4l2m2m",label:"MP4 - H.264 Hardware",group:"hardware"},{value:"mkv:libx264",label:"MKV - H.264 Software",group:"software"},{value:"mp4:libx264",label:"MP4 - H.264 Software",group:"software"},{value:"mkv:libx265",label:"MKV - H.265 Software (high CPU)",group:"hevc"},{value:"hevc",label:"HEVC/H.265 in MP4 (high CPU)",group:"hevc"},{value:"webm",label:"WebM (VP8)",group:"webm"}];function ye(t){return t.includes("v4l2m2m")}function we(t){return t.includes("libx265")||t==="hevc"}const je=[{value:"ultrafast",label:"Ultrafast",description:"Lowest CPU (~35-40%), lowest quality"},{value:"superfast",label:"Superfast",description:"Very low CPU"},{value:"veryfast",label:"Very Fast",description:"Low CPU"},{value:"faster",label:"Faster",description:"Below average CPU"},{value:"fast",label:"Fast",description:"Slightly below average CPU"},{value:"medium",label:"Medium",description:"Balanced CPU/quality (~50-60%)"},{value:"slow",label:"Slow",description:"Above average quality"},{value:"slower",label:"Slower",description:"High quality"},{value:"veryslow",label:"Very Slow",description:"Highest quality (~70-80%), highest CPU"}],Ne=[{value:0,label:"None"},{value:1,label:"Basic"},{value:2,label:"Digest"}],Ce=[{value:"off",label:"Off"},{value:"on",label:"On"},{value:"preview",label:"Preview"},{value:"both",label:"Both"}];export{ge as A,te as C,je as E,ee as F,Ce as L,ve as M,me as R,se as a,Z as b,J as c,he as d,Y as e,re as f,fe as g,ae as h,be as i,xe as j,ie as k,Ne as l,oe as m,ne as n,ce as o,le as p,ue as q,ye as r,we as s,de as t,pe as u,$ as v};
