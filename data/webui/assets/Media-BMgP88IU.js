import{j as e,h as H,r as c,a as R,o as _,p as K,q as U,s as Y,t as Z}from"./index-Cw3751_i.js";function A({offset:l,limit:t,total:o,onPageChange:a,context:u}){const d=Math.floor(l/t)+1,m=Math.ceil(o/t),n=o===0?0:l+1,x=Math.min(l+t,o),p=l>0,f=l+t<o;return e.jsxs("div",{className:"flex items-center justify-between py-3 px-1",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["Displaying ",n,"-",x," of ",o,u&&e.jsxs("span",{className:"text-gray-500",children:[" ",u]})]}),m>1&&e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>a(Math.max(0,l-t)),disabled:!p,className:"px-3 py-1 bg-surface-elevated hover:bg-surface rounded disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors","aria-label":"Previous page",children:"◀ Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-400",children:["Page ",d," of ",m]}),e.jsx("button",{onClick:()=>a(l+t),disabled:!f,className:"px-3 py-1 bg-surface-elevated hover:bg-surface rounded disabled:opacity-50 disabled:cursor-not-allowed text-sm transition-colors","aria-label":"Next page",children:"Next ▶"})]})]})}const b=100;function B(l,t){if(!l||l.length!==8)return null;const o=parseInt(l.substring(0,4),10),a=parseInt(l.substring(4,6),10)-1,u=parseInt(l.substring(6,8),10);if(isNaN(o)||isNaN(a)||isNaN(u))return null;let d=0,m=0,n=0;if(t){const p=t.split(":");p.length>=2&&(d=parseInt(p[0],10)||0,m=parseInt(p[1],10)||0,n=parseInt(p[2],10)||0)}const x=new Date(o,a,u,d,m,n);return isNaN(x.getTime())?null:x}function O(){const{addToast:l}=H(),[t,o]=c.useState(1),[a,u]=c.useState("pictures"),[d,m]=c.useState("all"),[n,x]=c.useState(null),[p,f]=c.useState(0),[r,v]=c.useState(null),[g,j]=c.useState(null),N=p*b;c.useEffect(()=>{f(0)},[t,a,n]);const{data:E}=R(),{data:L,isLoading:V}=_(t,N,b,n),{data:$,isLoading:F}=K(t,N,b,n),{data:y}=U(t,a==="pictures"?"pic":"movie",{enabled:d==="by-date"}),C=Y(),D=Z(),M=a==="pictures"?V:F,W=a==="pictures"?L:$,S=a==="pictures"?L?.pictures??[]:$?.movies??[],w=W?.total_count??0,z=s=>s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`,k=(s,i)=>{const h=B(s,i);return h?h.toLocaleDateString()+" "+h.toLocaleTimeString():"Unknown date"},G=c.useCallback((s,i)=>{i.stopPropagation(),j(s)},[]),q=c.useCallback(async()=>{if(g)try{a==="pictures"?await C.mutateAsync({camId:t,pictureId:g.id}):await D.mutateAsync({camId:t,movieId:g.id}),l(`${a==="pictures"?"Picture":"Movie"} deleted`,"success"),j(null),r?.id===g.id&&v(null)}catch{l("Failed to delete file","error")}},[g,a,t,C,D,l,r]),T=c.useCallback(()=>{j(null)},[]),P=C.isPending||D.isPending;return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-3xl font-bold",children:"Media"})}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"camera-select",className:"block text-sm font-medium mb-2",children:"Camera"}),e.jsx("select",{id:"camera-select",value:t,onChange:s=>o(parseInt(s.target.value)),className:"px-3 py-2 bg-surface border border-surface-elevated rounded-lg",children:E?.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("pictures"),className:`px-4 py-2 rounded-lg transition-colors ${a==="pictures"?"bg-primary text-white":"bg-surface-elevated hover:bg-surface"}`,children:"Pictures"}),e.jsx("button",{onClick:()=>u("movies"),className:`px-4 py-2 rounded-lg transition-colors ${a==="movies"?"bg-primary text-white":"bg-surface-elevated hover:bg-surface"}`,children:"Movies"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"View"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{m("all"),x(null)},className:`px-3 py-2 rounded-lg transition-colors text-sm ${d==="all"?"bg-primary text-white":"bg-surface-elevated hover:bg-surface"}`,children:"All"}),e.jsxs("button",{onClick:()=>m("by-date"),className:`px-3 py-2 rounded-lg transition-colors text-sm ${d==="by-date"?"bg-primary text-white":"bg-surface-elevated hover:bg-surface"}`,children:["By Date (",y?.dates.length??0,")"]})]})]})]}),d==="by-date"&&y&&y.dates.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-surface-elevated rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Browse by Date"}),n&&e.jsx("button",{onClick:()=>x(null),className:"ml-auto text-xs text-primary hover:underline",children:"Show all dates"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:y.dates.map(s=>{const i=B(s.date),h=i?i.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}):s.date;return e.jsxs("button",{onClick:()=>x(s.date),className:`px-3 py-1.5 rounded text-sm transition-colors ${n===s.date?"bg-primary text-white":"bg-surface hover:bg-surface-elevated"}`,children:[h," (",s.count,")"]},s.date)})})]}),!M&&w>0&&e.jsx(A,{offset:N,limit:b,total:w,onPageChange:s=>f(s/b),context:n?`on ${k(n)}`:void 0}),M?e.jsx("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-4",children:[1,2,3,4,5,6,7,8].map(s=>e.jsxs("div",{className:"bg-surface-elevated rounded-lg animate-pulse",children:[e.jsx("div",{className:"aspect-video bg-surface rounded-t-lg"}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"h-4 bg-surface rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-surface rounded w-1/2"})]})]},s))}):S.length===0?e.jsxs("div",{className:"bg-surface-elevated rounded-lg p-8 text-center",children:[e.jsxs("p",{className:"text-gray-400",children:["No ",a," found"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:a==="pictures"?"Motion detection snapshots will appear here":"Recorded videos will appear here"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-4",children:S.map(s=>e.jsxs("button",{className:"bg-surface-elevated rounded-lg overflow-hidden cursor-pointer hover:ring-2 hover:ring-primary focus:ring-2 focus:ring-primary focus:outline-none transition-all group relative text-left w-full",onClick:()=>v(s),"aria-label":`View ${s.filename}`,children:[e.jsx("button",{onClick:i=>G(s,i),className:"absolute top-2 right-2 z-10 p-1.5 bg-red-600/80 hover:bg-red-600 rounded opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity",title:"Delete","aria-label":`Delete ${s.filename}`,children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsxs("div",{className:"aspect-video bg-surface flex items-center justify-center relative overflow-hidden",children:[a==="pictures"?e.jsx("img",{src:s.path,alt:s.filename,className:"w-full h-full object-cover",loading:"lazy"}):s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.filename,className:"w-full h-full object-cover",loading:"lazy",onError:i=>{i.currentTarget.style.display="none";const h=i.currentTarget.parentElement;if(h){const I=h.querySelector(".fallback-icon");I&&(I.style.display="flex")}}}):null,e.jsx("div",{className:`fallback-icon text-gray-400 absolute inset-0 flex items-center justify-center ${s.thumbnail?"hidden":""}`,children:e.jsxs("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:z(s.size)}),e.jsx("span",{children:k(s.date,s.time)})]})]})]},s.id))}),!M&&w>0&&e.jsx(A,{offset:N,limit:b,total:w,onPageChange:s=>f(s/b),context:n?`on ${k(n)}`:void 0}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>v(null),children:e.jsxs("div",{className:"max-w-6xl w-full bg-surface-elevated rounded-lg overflow-hidden",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-surface flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.filename}),e.jsxs("p",{className:"text-sm text-gray-400",children:[z(r.size)," • ",k(r.date,r.time)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:r.path,download:r.filename,className:"px-3 py-1 bg-primary hover:bg-primary-hover rounded text-sm",onClick:s=>s.stopPropagation(),children:"Download"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),j(r)},className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm",children:"Delete"}),e.jsx("button",{onClick:()=>v(null),className:"px-3 py-1 bg-surface hover:bg-surface-elevated rounded text-sm",children:"Close"})]})]}),e.jsx("div",{className:"p-4",children:a==="pictures"?e.jsx("img",{src:r.path,alt:r.filename,className:"w-full h-auto max-h-[70vh] object-contain"}):e.jsx("video",{src:r.path,controls:!0,className:"w-full h-auto max-h-[70vh]",autoPlay:!0,children:"Your browser does not support video playback."})})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4",onClick:T,children:e.jsx("div",{className:"w-full max-w-md bg-surface-elevated rounded-lg",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["Delete ",a==="pictures"?"Picture":"Movie","?"]}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-medium text-white",children:g.filename}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:T,disabled:P,className:"px-4 py-2 bg-surface hover:bg-surface-elevated rounded-lg disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:P,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg disabled:opacity-50",children:P?"Deleting...":"Delete"})]})]})})})]})}export{O as Media};
