import{j as e,f as M,l as L,n as R,d as $,c as q,i as T,k as E,r as N,h as K}from"./index-CtmkANkd.js";function G({label:t,value:r,onChange:s,disabled:a=!1,helpText:o,error:p}){const c=()=>{a||s(!r)},l=!!p;return e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:c,disabled:a,className:"sr-only","aria-invalid":l}),e.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${r?"bg-primary":"bg-surface-elevated"} ${a?"opacity-50 cursor-not-allowed":""} ${l?"ring-2 ring-red-500":""}`}),e.jsx("div",{className:`absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${r?"transform translate-x-6":""}`})]}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"text-sm font-medium",children:t}),l&&e.jsx("p",{className:"text-sm text-red-400",role:"alert",children:p}),o&&!l&&e.jsx("p",{className:"text-sm text-gray-400",children:o})]})]})})}function W({label:t,value:r,onChange:s,min:a,max:o,step:p=1,unit:c="",disabled:l=!1,required:m=!1,helpText:g,error:i,showValue:j=!0,scale:x="linear"}){const d=n=>{if(x==="linear")return n;if(n===0)return a;const u=a===0?1:a,h=Math.log(u),_=Math.log(o),k=Math.log(n);return u+(k-h)/(_-h)*(o-u)},y=n=>{if(x==="linear")return n;if(n===a)return 0;const u=a===0?1:a,h=Math.log(u),_=Math.log(o),k=(n-u)/(o-u),A=h+k*(_-h);return Math.round(Math.exp(A))},f=n=>{const u=Number(n.target.value),h=y(u);s(h)},v=!!i,C=d(r),S=(C-a)/(o-a)*100,D=x==="logarithmic"?y(a+(o-a)/2):(a+o)/2,w=n=>n===0&&a===0?"0":Number.isInteger(n)?n.toString():n.toFixed(p>=1?0:p.toString().split(".")[1]?.length||1);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-medium",children:[t,m&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),j&&e.jsxs("span",{className:"text-sm font-mono text-gray-400",children:[r,c]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"range",value:C,onChange:f,min:a,max:o,step:x==="logarithmic"?1:p,disabled:l,className:`w-full h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed
            ${v?"slider-error":"slider-default"}`,style:{background:`linear-gradient(to right,
              rgb(59, 130, 246) 0%,
              rgb(59, 130, 246) ${S}%,
              rgb(55, 65, 81) ${S}%,
              rgb(55, 65, 81) 100%)`},"aria-invalid":v,"aria-describedby":v?`${t}-error`:void 0}),e.jsx("div",{className:"relative w-full h-4 mt-1",children:[0,25,50,75,100].map(n=>{const u=n===0||n===50||n===100;return e.jsx("div",{className:"absolute",style:{left:`${n}%`,transform:"translateX(-50%)"},children:e.jsx("div",{className:`w-px bg-gray-500 mx-auto ${u?"h-3":"h-2"}`})},n)})}),e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[e.jsxs("span",{children:[w(a),c]}),e.jsxs("span",{children:[w(D),c]}),e.jsxs("span",{children:[w(o),c]})]})})]}),v&&e.jsx("p",{id:`${t}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:i}),g&&!v&&e.jsx("p",{className:"mt-1 text-sm text-gray-400",children:g}),e.jsx("style",{children:`
        input[type='range']::-webkit-slider-thumb {
          appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-webkit-slider-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range']::-moz-range-thumb {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-moz-range-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range'].slider-error::-webkit-slider-thumb {
          background: rgb(239, 68, 68);
        }

        input[type='range'].slider-error::-moz-range-thumb {
          background: rgb(239, 68, 68);
        }
      `})]})}const P={list:async t=>(await $(`/0/api/profiles?camera_id=${t}`)).profiles||[],get:async t=>{const r=await $(`/0/api/profiles/${t}`);return{profile_id:r.profile_id,camera_id:r.camera_id,name:r.name,description:r.description,is_default:r.is_default,created_at:r.created_at,updated_at:r.updated_at,param_count:Object.keys(r.params).length,params:r.params}},create:async t=>(await M("/0/api/profiles",t)).profile_id,update:async(t,r)=>{await R(`/0/api/profiles/${t}`,r)},delete:async t=>{await L(`/0/api/profiles/${t}`)},apply:async t=>(await M(`/0/api/profiles/${t}/apply`,{})).requires_restart||[],setDefault:async t=>{await M(`/0/api/profiles/${t}/default`,{})}},b={all:["profiles"],lists:()=>[...b.all,"list"],list:t=>[...b.lists(),t],details:()=>[...b.all,"detail"],detail:t=>[...b.details(),t]};function z(t){return q({queryKey:b.list(t),queryFn:()=>P.list(t),staleTime:1e3*60*5})}function O(){const t=T();return E({mutationFn:r=>P.create(r),onSuccess:(r,s)=>{t.invalidateQueries({queryKey:b.list(s.camera_id)})}})}function Q(){const t=T();return E({mutationFn:r=>P.apply(r),onSuccess:()=>{t.invalidateQueries({queryKey:["config"]})}})}function V({cameraId:t,onClose:r}){const[s,a]=N.useState(""),[o,p]=N.useState(""),{mutate:c,isPending:l}=O(),m=()=>{s.trim()&&c({name:s.trim(),description:o.trim()||void 0,camera_id:t,snapshot_current:!0},{onSuccess:()=>{r()},onError:i=>{console.error("Failed to save profile:",i)}})},g=i=>{i.key==="Enter"&&!i.shiftKey?(i.preventDefault(),m()):i.key==="Escape"&&r()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-surface-base border border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Save Configuration Preset"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors","aria-label":"Close dialog",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"profile-name",className:"block text-sm font-medium text-gray-400 mb-1",children:["Preset Name ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{id:"profile-name",type:"text",value:s,onChange:i=>a(i.target.value),onKeyDown:g,placeholder:"e.g., Daytime, Nighttime",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0,maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"profile-description",className:"block text-sm font-medium text-gray-400 mb-1",children:"Description (optional)"}),e.jsx("textarea",{id:"profile-description",value:o,onChange:i=>p(i.target.value),placeholder:"Brief description of this preset",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none",rows:2,maxLength:200})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"This will save your current camera settings including brightness, motion detection, and framerate."})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:r,disabled:l,className:"flex-1 px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:!s.trim()||l,className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors disabled:bg-primary/30 disabled:cursor-not-allowed",children:l?"Saving...":"Save"})]})]})})}function X({cameraId:t,readOnly:r=!1}){const{data:s,isLoading:a,error:o}=z(t),{mutate:p,isPending:c}=Q(),{addToast:l}=K(),[m,g]=N.useState(null),[i,j]=N.useState(!1),x=()=>{if(m){const y=s?.find(f=>f.profile_id===m)?.name||"profile";p(m,{onSuccess:f=>{f.length>0?l(`Profile "${y}" applied. Restart required for: ${f.join(", ")}`,"warning"):l(`Profile "${y}" applied successfully`,"success"),g(null)},onError:f=>{l(`Failed to apply profile: ${f instanceof Error?f.message:"Unknown error"}`,"error")}})}};return o?e.jsx("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:e.jsxs("div",{className:"bg-danger/10 border border-danger rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-danger font-medium",children:"Failed to load profiles"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:o instanceof Error?o.message:"Unable to connect to profiles API"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Configuration Preset"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("select",{disabled:a||!s||s.length===0,value:m??"",onChange:d=>g(Number(d.target.value)||null),className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white disabled:text-gray-500 disabled:cursor-not-allowed appearance-none focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:a?"Loading...":!s||s.length===0?"No presets available":"Select a preset"}),s?.map(d=>e.jsxs("option",{value:d.profile_id,children:[d.is_default?"⭐ ":"",d.name,d.description?` - ${d.description}`:""]},d.profile_id))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!r&&e.jsx("button",{type:"button",onClick:()=>j(!0),className:"px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors",title:"Save current settings as a new preset",children:"Save"}),e.jsx("button",{type:"button",onClick:x,disabled:!m||c,className:"px-4 py-2 bg-primary text-white rounded-lg disabled:bg-primary/30 disabled:text-gray-500 disabled:cursor-not-allowed hover:bg-primary-hover transition-colors",title:"Apply selected preset to camera",children:c?"Applying...":"Apply"})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Quick switch camera settings • ",s?.length||0," preset",s?.length!==1?"s":""]})]}),i&&e.jsx(V,{cameraId:t,onClose:()=>j(!1)})]})}function Y(t){const[r,s]=t.split("x").map(Number);return{width:r||0,height:s||0}}function H(t,r){return`${t}x${r}`}function J(t,r,s){return Math.round(t/100*r*s)}function Z(t,r,s){const a=r*s;return a===0?0:Number((t/a*100).toFixed(2))}const F={disabled:"","camera-name":"%$",timestamp:"%Y-%m-%d\\n%T"};function ee(t){for(const[r,s]of Object.entries(F))if(s===t)return r;return"custom"}function te(t,r){return t==="custom"&&r!==void 0?r:F[t]||""}const B={"motion-triggered":{picture_output:"on"},"motion-triggered-one":{picture_output:"first"},best:{picture_output:"best"},center:{picture_output:"center"},"interval-snapshots":{picture_output:"off",snapshot_interval:60},manual:{picture_output:"off",snapshot_interval:0},off:{picture_output:"off",snapshot_interval:0}};function re(t,r){if(r>0)return"interval-snapshots";switch(t){case"on":return"motion-triggered";case"first":return"motion-triggered-one";case"best":return"best";case"center":return"center";case"off":return"manual";default:return"manual"}}function se(t){return B[t]||{picture_output:"off",snapshot_interval:0}}const I={"motion-triggered":{movie_output:!0,movie_output_motion:!0,emulate_motion:!1},continuous:{movie_output:!0,movie_output_motion:!1,emulate_motion:!0},off:{movie_output:!1,emulate_motion:!1}};function ae(t,r,s=!1){return t?s?"continuous":"motion-triggered":"off"}function ne(t){return I[t]||{movie_output:!1,emulate_motion:!1}}export{X as C,W as F,J as a,G as b,Y as c,te as d,re as e,H as f,se as g,ae as h,ee as m,Z as p,ne as r};
