import{r as b,l as V,j as t,h as k,m as H,p as q,f as P,e as O,i as E,k as D,a as L,o as Q}from"./index-DQuF-L2X.js";function B(e){return{streamUrl:b.useMemo(()=>{const s=V(),r=`/${e}/mjpg/stream`;return s?`${r}?token=${encodeURIComponent(s)}`:r},[e]),isLoading:!1,error:null}}const T="motion-camera-restart-timestamps";function S(e){try{const a=localStorage.getItem(T);if(a)return JSON.parse(a)[String(e)]||0}catch{}return 0}function Z(e){try{const a=localStorage.getItem(T),s=a?JSON.parse(a):{};s[String(e)]=Date.now(),e!==0&&(s[0]=Date.now()),localStorage.setItem(T,JSON.stringify(s))}catch{}}const A="camera-restarted";function ee({cameraId:e,className:a=""}){const{streamUrl:s}=B(e),r=b.useRef(null),o=b.useRef(S(e)),[u,d]=b.useState(()=>S(e)),c=b.useCallback(()=>{setTimeout(()=>{d(n=>n+1)},2e3)},[]);b.useEffect(()=>{const n=l=>{const x=l.detail?.cameraId;if(!x||x===0||x===e){const m=Date.now();o.current=m,d(m)}};return window.addEventListener(A,n),()=>{window.removeEventListener(A,n)}},[e]),b.useEffect(()=>{const n=()=>{const x=S(e),m=e!==0?S(0):0,v=Math.max(x,m);v>o.current&&(o.current=v,d(v))};n();const l=setInterval(n,5e3);return()=>clearInterval(l)},[e]);const p=s?`${s}${s.includes("?")?"&":"?"}_k=${u}`:"";return t.jsx("div",{className:`w-full ${a}`,children:t.jsx("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:t.jsx("img",{ref:r,src:p,alt:`Camera ${e} stream`,className:"absolute inset-0 w-full h-full object-contain",onError:c})})})}function te({label:e,value:a,onChange:s,options:r,disabled:o=!1,required:u=!1,helpText:d,error:c}){const p=l=>{s(l.target.value)},n=!!c;return t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium mb-1",children:[e,u&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("select",{value:a,onChange:p,disabled:o,required:u,className:`w-full px-3 py-2 bg-surface border rounded-lg focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed ${n?"border-red-500 focus:ring-red-500":"border-surface-elevated focus:ring-primary"}`,"aria-invalid":n,"aria-describedby":n?`${e}-error`:void 0,children:r.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))}),n&&t.jsx("p",{id:`${e}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:c}),d&&!n&&t.jsx("p",{className:"mt-1 text-sm text-gray-400",children:d})]})}function ae({label:e,value:a,onChange:s,disabled:r=!1,helpText:o,error:u}){const d=()=>{r||s(!a)},c=!!u;return t.jsx("div",{className:"mb-4",children:t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"checkbox",checked:a,onChange:d,disabled:r,className:"sr-only","aria-invalid":c}),t.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${a?"bg-primary":"bg-surface-elevated"} ${r?"opacity-50 cursor-not-allowed":""} ${c?"ring-2 ring-red-500":""}`}),t.jsx("div",{className:`absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${a?"transform translate-x-6":""}`})]}),t.jsxs("div",{className:"ml-3",children:[t.jsx("span",{className:"text-sm font-medium",children:e}),c&&t.jsx("p",{className:"text-sm text-red-400",role:"alert",children:u}),o&&!c&&t.jsx("p",{className:"text-sm text-gray-400",children:o})]})]})})}function re({label:e,value:a,onChange:s,min:r,max:o,step:u=1,unit:d="",disabled:c=!1,required:p=!1,helpText:n,error:l,showValue:x=!0,scale:m="linear"}){const v=i=>{if(m==="linear")return i;if(i===0)return r;const h=r===0?1:r,y=Math.log(h),C=Math.log(o),M=Math.log(i);return h+(M-y)/(C-y)*(o-h)},f=i=>{if(m==="linear")return i;if(i===r)return 0;const h=r===0?1:r,y=Math.log(h),C=Math.log(o),M=(i-h)/(o-h),K=y+M*(C-y);return Math.round(Math.exp(K))},N=i=>{const h=Number(i.target.value),y=f(h);s(y)},g=!!l,w=v(a),R=(w-r)/(o-r)*100,U=m==="logarithmic"?f(r+(o-r)/2):(r+o)/2,_=i=>i===0&&r===0?"0":Number.isInteger(i)?i.toString():i.toFixed(u>=1?0:u.toString().split(".")[1]?.length||1);return t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("label",{className:"block text-sm font-medium",children:[e,p&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),x&&t.jsxs("span",{className:"text-sm font-mono text-gray-400",children:[a,d]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"range",value:w,onChange:N,min:r,max:o,step:m==="logarithmic"?1:u,disabled:c,className:`w-full h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed
            ${g?"slider-error":"slider-default"}`,style:{background:`linear-gradient(to right,
              rgb(59, 130, 246) 0%,
              rgb(59, 130, 246) ${R}%,
              rgb(55, 65, 81) ${R}%,
              rgb(55, 65, 81) 100%)`},"aria-invalid":g,"aria-describedby":g?`${e}-error`:void 0}),t.jsx("div",{className:"relative w-full h-4 mt-1",children:[0,25,50,75,100].map(i=>{const h=i===0||i===50||i===100;return t.jsx("div",{className:"absolute",style:{left:`${i}%`,transform:"translateX(-50%)"},children:t.jsx("div",{className:`w-px bg-gray-500 mx-auto ${h?"h-3":"h-2"}`})},i)})}),t.jsx("div",{className:"relative w-full",children:t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[t.jsxs("span",{children:[_(r),d]}),t.jsxs("span",{children:[_(U),d]}),t.jsxs("span",{children:[_(o),d]})]})})]}),g&&t.jsx("p",{id:`${e}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:l}),n&&!g&&t.jsx("p",{className:"mt-1 text-sm text-gray-400",children:n}),t.jsx("style",{children:`
        input[type='range']::-webkit-slider-thumb {
          appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-webkit-slider-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range']::-moz-range-thumb {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-moz-range-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range'].slider-error::-webkit-slider-thumb {
          background: rgb(239, 68, 68);
        }

        input[type='range'].slider-error::-moz-range-thumb {
          background: rgb(239, 68, 68);
        }
      `})]})}const $={list:async e=>(await P(`/0/api/profiles?camera_id=${e}`)).profiles||[],get:async e=>{const a=await P(`/0/api/profiles/${e}`);return{profile_id:a.profile_id,camera_id:a.camera_id,name:a.name,description:a.description,is_default:a.is_default,created_at:a.created_at,updated_at:a.updated_at,param_count:Object.keys(a.params).length,params:a.params}},create:async e=>(await k("/0/api/profiles",e)).profile_id,update:async(e,a)=>{await q(`/0/api/profiles/${e}`,a)},delete:async e=>{await H(`/0/api/profiles/${e}`)},apply:async e=>(await k(`/0/api/profiles/${e}/apply`,{})).requires_restart||[],setDefault:async e=>{await k(`/0/api/profiles/${e}/default`,{})}},j={all:["profiles"],lists:()=>[...j.all,"list"],list:e=>[...j.lists(),e],details:()=>[...j.all,"detail"],detail:e=>[...j.details(),e]};function G(e){return O({queryKey:j.list(e),queryFn:()=>$.list(e),staleTime:1e3*60*5})}function I(){const e=E();return D({mutationFn:a=>$.create(a),onSuccess:(a,s)=>{e.invalidateQueries({queryKey:j.list(s.camera_id)})}})}function z(){const e=E();return D({mutationFn:a=>$.apply(a),onSuccess:()=>{e.invalidateQueries({queryKey:["config"]})}})}function W({cameraId:e,onClose:a}){const[s,r]=b.useState(""),[o,u]=b.useState(""),{mutate:d,isPending:c}=I(),p=()=>{s.trim()&&d({name:s.trim(),description:o.trim()||void 0,camera_id:e,snapshot_current:!0},{onSuccess:()=>{a()},onError:l=>{console.error("Failed to save profile:",l)}})},n=l=>{l.key==="Enter"&&!l.shiftKey?(l.preventDefault(),p()):l.key==="Escape"&&a()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-surface-base border border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Save Configuration Preset"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors","aria-label":"Close dialog",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"profile-name",className:"block text-sm font-medium text-gray-400 mb-1",children:["Preset Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsx("input",{id:"profile-name",type:"text",value:s,onChange:l=>r(l.target.value),onKeyDown:n,placeholder:"e.g., Daytime, Nighttime",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0,maxLength:50})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"profile-description",className:"block text-sm font-medium text-gray-400 mb-1",children:"Description (optional)"}),t.jsx("textarea",{id:"profile-description",value:o,onChange:l=>u(l.target.value),placeholder:"Brief description of this preset",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none",rows:2,maxLength:200})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"This will save your current camera settings including brightness, motion detection, and framerate."})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:a,disabled:c,className:"flex-1 px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{onClick:p,disabled:!s.trim()||c,className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors disabled:bg-primary/30 disabled:cursor-not-allowed",children:c?"Saving...":"Save"})]})]})})}function se({cameraId:e,readOnly:a=!1}){const s=E(),{data:r,isLoading:o,error:u}=G(e),{mutate:d,isPending:c}=z(),{addToast:p}=L(),[n,l]=b.useState(null),[x,m]=b.useState(!1),v=()=>{if(n){const N=r?.find(g=>g.profile_id===n)?.name||"profile";d(n,{onSuccess:async g=>{if(g.length>0){p(`Profile "${N}" applied. Restarting camera...`,"info");try{await Q(e),await new Promise(w=>setTimeout(w,2e3)),await s.invalidateQueries({queryKey:["config"]}),p(`Profile "${N}" applied. Camera restarted.`,"success")}catch(w){console.error("Failed to restart camera:",w),p("Profile applied but camera restart failed. Please restart manually.","warning")}}else p(`Profile "${N}" applied successfully`,"success");l(null)},onError:g=>{p(`Failed to apply profile: ${g instanceof Error?g.message:"Unknown error"}`,"error")}})}};return u?t.jsx("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:t.jsxs("div",{className:"bg-danger/10 border border-danger rounded-lg p-3",children:[t.jsx("p",{className:"text-sm text-danger font-medium",children:"Failed to load profiles"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:u instanceof Error?u.message:"Unable to connect to profiles API"})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Configuration Preset"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsxs("select",{disabled:o||!r||r.length===0,value:n??"",onChange:f=>l(Number(f.target.value)||null),className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white disabled:text-gray-500 disabled:cursor-not-allowed appearance-none focus:outline-none focus:ring-2 focus:ring-primary",children:[t.jsx("option",{value:"",children:o?"Loading...":!r||r.length===0?"No presets available":"Select a preset"}),r?.map(f=>t.jsxs("option",{value:f.profile_id,children:[f.is_default?"⭐ ":"",f.name,f.description?` - ${f.description}`:""]},f.profile_id))]}),t.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!a&&t.jsx("button",{type:"button",onClick:()=>m(!0),className:"px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors",title:"Save current settings as a new preset",children:"Save"}),t.jsx("button",{type:"button",onClick:v,disabled:!n||c,className:"px-4 py-2 bg-primary text-white rounded-lg disabled:bg-primary/30 disabled:text-gray-500 disabled:cursor-not-allowed hover:bg-primary-hover transition-colors",title:"Apply selected preset to camera",children:c?"Applying...":"Apply"})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Quick switch camera settings • ",r?.length||0," preset",r?.length!==1?"s":""]})]}),x&&t.jsx(W,{cameraId:e,onClose:()=>m(!1)})]})}function le(e){const[a,s]=e.split("x").map(Number);return{width:a||0,height:s||0}}function oe(e,a){return`${e}x${a}`}function ne(e,a,s){return Math.round(e/100*a*s)}function ie(e,a,s){const r=a*s;return r===0?0:Number((e/r*100).toFixed(2))}const F={disabled:"","camera-name":"%$",timestamp:"%Y-%m-%d\\n%T"};function ce(e){for(const[a,s]of Object.entries(F))if(s===e)return a;return"custom"}function ue(e,a){return e==="custom"&&a!==void 0?a:F[e]||""}const J={"motion-triggered":{picture_output:"on"},"motion-triggered-one":{picture_output:"first"},best:{picture_output:"best"},center:{picture_output:"center"},"interval-snapshots":{picture_output:"off",snapshot_interval:60},manual:{picture_output:"off",snapshot_interval:0},off:{picture_output:"off",snapshot_interval:0}};function de(e,a){if(a>0)return"interval-snapshots";switch(e){case"on":return"motion-triggered";case"first":return"motion-triggered-one";case"best":return"best";case"center":return"center";case"off":return"manual";default:return"manual"}}function pe(e){return J[e]||{picture_output:"off",snapshot_interval:0}}const X={"motion-triggered":{movie_output:!0,movie_output_motion:!0,emulate_motion:!1},continuous:{movie_output:!0,movie_output_motion:!1,emulate_motion:!0},off:{movie_output:!1,emulate_motion:!1}};function me(e,a,s=!1){return e?s?"continuous":"motion-triggered":"off"}function fe(e){return X[e]||{movie_output:!1,emulate_motion:!1}}function ge(e){return O({queryKey:["cameraCapabilities",e],queryFn:async()=>{const a=await P("/0/status.json"),s=`cam${e}`,r=a.status[s];return r&&typeof r=="object"?r.supportedControls||{}:{}},staleTime:6e4,retry:1,enabled:e>0})}const he=[{width:320,height:240,label:"320x240 (QVGA)"},{width:640,height:480,label:"640x480 (VGA)"},{width:800,height:600,label:"800x600 (SVGA)"},{width:1024,height:768,label:"1024x768 (XGA)"},{width:1280,height:720,label:"1280x720 (HD)"},{width:1920,height:1080,label:"1920x1080 (Full HD)"},{width:2560,height:1440,label:"2560x1440 (QHD)"},{width:3840,height:2160,label:"3840x2160 (4K)"}],be=[{value:0,label:"0°"},{value:90,label:"90°"},{value:180,label:"180°"},{value:270,label:"270°"}],xe=[{value:0,label:"Auto"},{value:1,label:"Incandescent"},{value:2,label:"Tungsten"},{value:3,label:"Fluorescent"},{value:4,label:"Indoor"},{value:5,label:"Daylight"},{value:6,label:"Cloudy"},{value:7,label:"Custom"}],ve=[{value:0,label:"Manual"},{value:1,label:"Auto"},{value:2,label:"Continuous"}],ye=[{value:0,label:"Normal"},{value:1,label:"Macro"},{value:2,label:"Full"}],we=[{value:0,label:"Normal"},{value:1,label:"Fast"}],je=[{value:"mkv",label:"MKV (Matroska)",group:"basic"},{value:"mp4",label:"MP4",group:"basic"},{value:"mov",label:"MOV (QuickTime)",group:"basic"},{value:"3gp",label:"3GP (Mobile)",group:"basic"},{value:"mkv:h264_v4l2m2m",label:"MKV - H.264 Hardware",group:"hardware"},{value:"mp4:h264_v4l2m2m",label:"MP4 - H.264 Hardware",group:"hardware"},{value:"mkv:libx264",label:"MKV - H.264 Software",group:"software"},{value:"mp4:libx264",label:"MP4 - H.264 Software",group:"software"},{value:"mkv:libx265",label:"MKV - H.265 Software (high CPU)",group:"hevc"},{value:"hevc",label:"HEVC/H.265 in MP4 (high CPU)",group:"hevc"},{value:"webm",label:"WebM (VP8)",group:"webm"}];function Ne(e){return e.includes("v4l2m2m")}function Se(e){return e.includes("libx265")||e==="hevc"}const _e=[{value:"ultrafast",label:"Ultrafast",description:"Lowest CPU (~35-40%), lowest quality"},{value:"superfast",label:"Superfast",description:"Very low CPU"},{value:"veryfast",label:"Very Fast",description:"Low CPU"},{value:"faster",label:"Faster",description:"Below average CPU"},{value:"fast",label:"Fast",description:"Slightly below average CPU"},{value:"medium",label:"Medium",description:"Balanced CPU/quality (~50-60%)"},{value:"slow",label:"Slow",description:"Above average quality"},{value:"slower",label:"Slower",description:"High quality"},{value:"veryslow",label:"Very Slow",description:"Highest quality (~70-80%), highest CPU"}],Ce=[{value:0,label:"None"},{value:1,label:"Basic"},{value:2,label:"Digest"}],Me=[{value:"off",label:"Off"},{value:"on",label:"On"},{value:"preview",label:"Preview"},{value:"both",label:"Both"}];export{xe as A,se as C,_e as E,re as F,Me as L,je as M,he as R,ne as a,ae as b,te as c,ve as d,ee as e,oe as f,be as g,le as h,ye as i,we as j,ue as k,Ce as l,ce as m,de as n,pe as o,ie as p,me as q,Ne as r,Se as s,fe as t,ge as u,Z as v,A as w};
