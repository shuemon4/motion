import{j as t,i as C,k as K,m as Q,d as E,c as A,f as _,h as k,r as w,e as L}from"./index-BF3tZLEz.js";function G({label:e,value:r,onChange:a,disabled:s=!1,helpText:i,error:l}){const d=()=>{s||a(!r)},c=!!l;return t.jsx("div",{className:"mb-4",children:t.jsxs("label",{className:"flex items-center cursor-pointer",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"checkbox",checked:r,onChange:d,disabled:s,className:"sr-only","aria-invalid":c}),t.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${r?"bg-primary":"bg-surface-elevated"} ${s?"opacity-50 cursor-not-allowed":""} ${c?"ring-2 ring-red-500":""}`}),t.jsx("div",{className:`absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform ${r?"transform translate-x-6":""}`})]}),t.jsxs("div",{className:"ml-3",children:[t.jsx("span",{className:"text-sm font-medium",children:e}),c&&t.jsx("p",{className:"text-sm text-red-400",role:"alert",children:l}),i&&!c&&t.jsx("p",{className:"text-sm text-gray-400",children:i})]})]})})}function W({label:e,value:r,onChange:a,min:s,max:i,step:l=1,unit:d="",disabled:c=!1,required:m=!1,helpText:h,error:o,showValue:N=!0,scale:b="linear"}){const p=n=>{if(b==="linear")return n;if(n===0)return s;const f=s===0?1:s,x=Math.log(f),M=Math.log(i),S=Math.log(n);return f+(S-x)/(M-x)*(i-f)},y=n=>{if(b==="linear")return n;if(n===s)return 0;const f=s===0?1:s,x=Math.log(f),M=Math.log(i),S=(n-f)/(i-f),F=x+S*(M-x);return Math.round(Math.exp(F))},g=n=>{const f=Number(n.target.value),x=y(f);a(x)},v=!!o,$=p(r),D=($-s)/(i-s)*100,q=b==="logarithmic"?y(s+(i-s)/2):(s+i)/2,P=n=>n===0&&s===0?"0":Number.isInteger(n)?n.toString():n.toFixed(l>=1?0:l.toString().split(".")[1]?.length||1);return t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("label",{className:"block text-sm font-medium",children:[e,m&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),N&&t.jsxs("span",{className:"text-sm font-mono text-gray-400",children:[r,d]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"range",value:$,onChange:g,min:s,max:i,step:b==="logarithmic"?1:l,disabled:c,className:`w-full h-2 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed
            ${v?"slider-error":"slider-default"}`,style:{background:`linear-gradient(to right,
              rgb(59, 130, 246) 0%,
              rgb(59, 130, 246) ${D}%,
              rgb(55, 65, 81) ${D}%,
              rgb(55, 65, 81) 100%)`},"aria-invalid":v,"aria-describedby":v?`${e}-error`:void 0}),t.jsx("div",{className:"relative w-full h-4 mt-1",children:[0,25,50,75,100].map(n=>{const f=n===0||n===50||n===100;return t.jsx("div",{className:"absolute",style:{left:`${n}%`,transform:"translateX(-50%)"},children:t.jsx("div",{className:`w-px bg-gray-500 mx-auto ${f?"h-3":"h-2"}`})},n)})}),t.jsx("div",{className:"relative w-full",children:t.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[t.jsxs("span",{children:[P(s),d]}),t.jsxs("span",{children:[P(q),d]}),t.jsxs("span",{children:[P(i),d]})]})})]}),v&&t.jsx("p",{id:`${e}-error`,className:"mt-1 text-sm text-red-400",role:"alert",children:o}),h&&!v&&t.jsx("p",{className:"mt-1 text-sm text-gray-400",children:h}),t.jsx("style",{children:`
        input[type='range']::-webkit-slider-thumb {
          appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-webkit-slider-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range']::-moz-range-thumb {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: rgb(59, 130, 246);
          cursor: pointer;
          border: 2px solid rgb(30, 41, 59);
        }

        input[type='range']::-moz-range-thumb:hover {
          background: rgb(96, 165, 250);
        }

        input[type='range'].slider-error::-webkit-slider-thumb {
          background: rgb(239, 68, 68);
        }

        input[type='range'].slider-error::-moz-range-thumb {
          background: rgb(239, 68, 68);
        }
      `})]})}const j={list:async e=>(await E(`/0/api/profiles?camera_id=${e}`)).profiles||[],get:async e=>{const r=await E(`/0/api/profiles/${e}`);return{profile_id:r.profile_id,camera_id:r.camera_id,name:r.name,description:r.description,is_default:r.is_default,created_at:r.created_at,updated_at:r.updated_at,param_count:Object.keys(r.params).length,params:r.params}},create:async e=>(await C("/0/api/profiles",e)).profile_id,update:async(e,r)=>{await Q(`/0/api/profiles/${e}`,r)},delete:async e=>{await K(`/0/api/profiles/${e}`)},apply:async e=>(await C(`/0/api/profiles/${e}/apply`,{})).requires_restart||[],setDefault:async e=>{await C(`/0/api/profiles/${e}/default`,{})}},u={all:["profiles"],lists:()=>[...u.all,"list"],list:e=>[...u.lists(),e],details:()=>[...u.all,"detail"],detail:e=>[...u.details(),e]};function R(e){return A({queryKey:u.list(e),queryFn:()=>j.list(e),staleTime:1e3*60*5})}function z(){const e=_();return k({mutationFn:r=>j.create(r),onSuccess:(r,a)=>{e.invalidateQueries({queryKey:u.list(a.camera_id)})}})}function X(){const e=_();return k({mutationFn:r=>j.delete(r),onMutate:async r=>{await e.cancelQueries({queryKey:u.all});const a=e.getQueriesData({queryKey:u.lists()});return e.setQueriesData({queryKey:u.lists()},s=>s?.filter(i=>i.profile_id!==r)),{previousProfiles:a}},onError:(r,a,s)=>{s?.previousProfiles&&s.previousProfiles.forEach(([i,l])=>{e.setQueryData(i,l)})},onSettled:()=>{e.invalidateQueries({queryKey:u.all})}})}function O(){const e=_();return k({mutationFn:r=>j.apply(r),onSuccess:()=>{e.invalidateQueries({queryKey:["config-quick"]}),e.invalidateQueries({queryKey:["config"]})}})}function Y(){const e=_();return k({mutationFn:r=>j.setDefault(r),onMutate:async r=>{await e.cancelQueries({queryKey:u.all});const a=e.getQueriesData({queryKey:u.lists()});return e.setQueriesData({queryKey:u.lists()},s=>s?.map(i=>({...i,is_default:i.profile_id===r}))),{previousProfiles:a}},onError:(r,a,s)=>{s?.previousProfiles&&s.previousProfiles.forEach(([i,l])=>{e.setQueryData(i,l)})},onSettled:()=>{e.invalidateQueries({queryKey:u.all})}})}function V({cameraId:e,onClose:r}){const[a,s]=w.useState(""),[i,l]=w.useState(""),{mutate:d,isPending:c}=z(),m=()=>{a.trim()&&d({name:a.trim(),description:i.trim()||void 0,camera_id:e,snapshot_current:!0},{onSuccess:()=>{r()},onError:o=>{console.error("Failed to save profile:",o)}})},h=o=>{o.key==="Enter"&&!o.shiftKey?(o.preventDefault(),m()):o.key==="Escape"&&r()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:t.jsxs("div",{className:"bg-surface-base border border-gray-700 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Save Configuration Preset"}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors","aria-label":"Close dialog",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"profile-name",className:"block text-sm font-medium text-gray-400 mb-1",children:["Preset Name ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsx("input",{id:"profile-name",type:"text",value:a,onChange:o=>s(o.target.value),onKeyDown:h,placeholder:"e.g., Daytime, Nighttime",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0,maxLength:50})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"profile-description",className:"block text-sm font-medium text-gray-400 mb-1",children:"Description (optional)"}),t.jsx("textarea",{id:"profile-description",value:i,onChange:o=>l(o.target.value),placeholder:"Brief description of this preset",className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary resize-none",rows:2,maxLength:200})]}),t.jsx("p",{className:"text-xs text-gray-500",children:"This will save your current camera settings including brightness, motion detection, and framerate."})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{onClick:m,disabled:!a.trim()||c,className:"flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors disabled:bg-primary/30 disabled:cursor-not-allowed",children:c?"Saving...":"Save"})]})]})})}function H({cameraId:e,readOnly:r=!1}){const{data:a,isLoading:s,error:i}=R(e),{mutate:l,isPending:d}=O(),{addToast:c}=L(),[m,h]=w.useState(null),[o,N]=w.useState(!1),b=()=>{if(m){const y=a?.find(g=>g.profile_id===m)?.name||"profile";l(m,{onSuccess:g=>{g.length>0?c(`Profile "${y}" applied. Restart required for: ${g.join(", ")}`,"warning"):c(`Profile "${y}" applied successfully`,"success"),h(null)},onError:g=>{c(`Failed to apply profile: ${g instanceof Error?g.message:"Unknown error"}`,"error")}})}};return i?t.jsx("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:t.jsxs("div",{className:"bg-danger/10 border border-danger rounded-lg p-3",children:[t.jsx("p",{className:"text-sm text-danger font-medium",children:"Failed to load profiles"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:i instanceof Error?i.message:"Unable to connect to profiles API"})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4 pb-4 border-b border-surface-elevated",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Configuration Preset"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsxs("select",{disabled:s||!a||a.length===0,value:m??"",onChange:p=>h(Number(p.target.value)||null),className:"w-full px-3 py-2 bg-surface-elevated border border-gray-600 rounded-lg text-white disabled:text-gray-500 disabled:cursor-not-allowed appearance-none focus:outline-none focus:ring-2 focus:ring-primary",children:[t.jsx("option",{value:"",children:s?"Loading...":!a||a.length===0?"No presets available":"Select a preset"}),a?.map(p=>t.jsxs("option",{value:p.profile_id,children:[p.is_default?"⭐ ":"",p.name,p.description?` - ${p.description}`:""]},p.profile_id))]}),t.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),!r&&t.jsx("button",{type:"button",onClick:()=>N(!0),className:"px-4 py-2 bg-surface-elevated border border-gray-600 text-white rounded-lg hover:bg-surface-hover transition-colors",title:"Save current settings as a new preset",children:"Save"}),t.jsx("button",{type:"button",onClick:b,disabled:!m||d,className:"px-4 py-2 bg-primary text-white rounded-lg disabled:bg-primary/30 disabled:text-gray-500 disabled:cursor-not-allowed hover:bg-primary-hover transition-colors",title:"Apply selected preset to camera",children:d?"Applying...":"Apply"})]}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Quick switch camera settings • ",a?.length||0," preset",a?.length!==1?"s":""]})]}),o&&t.jsx(V,{cameraId:e,onClose:()=>N(!1)})]})}function J(e){const[r,a]=e.split("x").map(Number);return{width:r||0,height:a||0}}function Z(e,r){return`${e}x${r}`}function ee(e,r,a){return Math.round(e/100*r*a)}function te(e,r,a){const s=r*a;return s===0?0:Number((e/s*100).toFixed(2))}const T={disabled:"","camera-name":"%$",timestamp:"%Y-%m-%d\\n%T"};function re(e){for(const[r,a]of Object.entries(T))if(a===e)return r;return"custom"}function se(e,r){return e==="custom"&&r!==void 0?r:T[e]||""}const B={"motion-triggered":{picture_output:"on"},"motion-triggered-one":{picture_output:"first"},best:{picture_output:"best"},center:{picture_output:"center"},"interval-snapshots":{picture_output:"off",snapshot_interval:60},manual:{picture_output:"off",snapshot_interval:0},off:{picture_output:"off",snapshot_interval:0}};function ae(e,r){if(r>0)return"interval-snapshots";switch(e){case"on":return"motion-triggered";case"first":return"motion-triggered-one";case"best":return"best";case"center":return"center";case"off":return"manual";default:return"manual"}}function ie(e){return B[e]||{picture_output:"off",snapshot_interval:0}}const I={"motion-triggered":{movie_output:!0,movie_output_motion:!0},continuous:{movie_output:!0,movie_output_motion:!1},off:{movie_output:!1}};function ne(e,r){return e?r?"motion-triggered":"continuous":"off"}function oe(e){return I[e]||{movie_output:!1}}export{H as C,W as F,V as P,ee as a,G as b,J as c,se as d,ae as e,Z as f,ie as g,ne as h,O as i,X as j,Y as k,re as m,te as p,oe as r,R as u};
